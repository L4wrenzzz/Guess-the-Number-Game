<!DOCTYPE html>
<html>
<head>
    <title>Guess the Number Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Base reset and theme */
        * { box-sizing: border-box; }
        :root {
            --gap: 32px;
            --page-pad: 16px;
            --lbw: 320px;
         }
        html, body { height: 100%; }
        body {
            margin: 0;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow-x: hidden;
        }

        /* Intro screen centering (works for mobile & desktop) */
        .flex-center {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            padding: 24px;
        }

        /* Game layout (mobile-first) */
        .game-grid {
            display: block;
            width: 100%;
            padding:  24px var(--page-pad) 48px;
        }

        .leaderboard {
            width: 100%;
            max-width: 340px;
            margin: 0 auto var(--gap);
            text-align: center;
        }

        .game-center {
            width: 100%;
            max-width: 720px;
            margin: 0 auto;
            text-align: center;
        }

        .back-button-container {
            position: static;
            width: 100%;
            text-align: center;
            margin: 10px 0;
        }

        /* Desktop*/
        @media (min-width: 768px) {
        .game-grid {
            padding-left: calc(var(--page-pad) + var(--lbw) + var(--gap));
            padding-right: calc(var(--page-pad) + var(--lbw) + var(--gap)); /* ‚Üê symmetric */
            min-height: 100vh;
        }

        .leaderboard {
            position: fixed;
            left: var(--page-pad);
            top: 40px;
            width: var(--lbw);
            max-width: none;
            text-align: left;
            margin: 0;
        }

        .game-center {
            max-width: 720px;
            margin-inline: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 40px;
        }

        .back-button-container {
            position: fixed;
            top: 20px;
            left: var(--page-pad);
            width: auto;
            text-align: left;
            margin: 0;
            z-index: 10;
        }
    }
        .timer { font-size: 1.2em; color: #ff2e2e; }
        ul { list-style: none; padding-left: 0; margin: 0; }
        li { margin: 3px 0; }
    </style>
</head>
<body>
    {% if not game_started %}
        <div class="flex-center">
            <h1>‚ùì Guess the Number Game</h1>
            <form method="POST">
                <input type="hidden" name="form_type" value="start_game">
                <input type="text" name="username" placeholder="Enter your name" autocomplete="off" required>
                <button type="submit">Play</button>
            </form>
        </div>
    {% else %}
        <div class="game-grid">
            <div class="leaderboard">
                <h2>üèÜ Leaderboard</h2>
                {% if leaderboard %}
                <ul>
                    {% for name, score in leaderboard %}
                        <li>{{ loop.index }}. {{ name }} - {{ score }} points</li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No scores yet.</p>
                {% endif %}
            </div>

            <div class="game-center">
                <h1>‚ùì Guess the Number Game</h1>

                <div class="back-button-container">
                    <form method="POST">
                        <input type="hidden" name="form_type" value="go_back">
                        <button type="submit" style="background-color: #ff0000;">Back</button>
                    </form>
                </div>
                
                <p><strong>Hello!</strong> {{ username }}</p>

                <form method="POST">
                    <label>Choose difficulty:</label>
                    <select name="difficulty">
                        <option value="easy" {% if selected_difficulty == 'easy' %}selected{% endif %}>Easy(1-10)</option>
                        <option value="medium" {% if selected_difficulty == 'medium' %}selected{% endif %}>Medium(1-50)</option>
                        <option value="hard" {% if selected_difficulty == 'hard' %}selected{% endif %}>Hard(1-100)</option>
                        <option value="impossible" {% if selected_difficulty == 'impossible' %}selected{% endif %}>Impossible(1-1000)</option>
                    </select>
                    <button type="submit" name="form_type" value="set_difficulty">Set Difficulty</button>
                </form>

                {% if not game_ready %}
                    <form method="POST">
                        <input type="hidden" name="form_type" value="start_guessing">
                        <button type="submit">Start Game</button>
                    </form>
                {% else %}
                    <form method="POST">
                        <label for="guess">Your Guess:</label>
                        <input type="number" name="guess" id="guess" required placeholder="Enter your guess">
                        <button type="submit" name="form_type" value="make_guess">Guess</button>
                    </form>
                {% endif %}

                <p>{{ message }}</p>
                <p class="timer">‚è±Ô∏è Time: <span id="timer">{{ timer }}</span> sec</p>
                <p>Total Games: {{ totalGames }}</p>
                <p>Correct Guesses: {{ correctGuesses }}</p>

                {% if '‚úÖ' in message %}
                    <img src="{{ url_for('static', filename='correct.gif') }}" width="200">
                {% elif '‚ùå' in message %}
                    <img src="{{ url_for('static', filename='wrong.gif') }}" width="200">
                {% endif %}
            </div>
        </div>

        <audio id="winSound" src="{{ url_for('static', filename='win.mp3') }}"></audio>
        <audio id="loseSound" src="{{ url_for('static', filename='lose.mp3') }}"></audio>

        {% if game_ready %}
        <script>
            let seconds = parseInt(document.getElementById('timer').innerText);
            setInterval(() => {
                seconds += 1;
                document.getElementById('timer').innerText = seconds;
            }, 1000);
        </script>
        {% endif %}
        
        <script>
            const winSound = document.getElementById('winSound');
            const loseSound = document.getElementById('loseSound');
            const message = "{{ message }}";

            if (message.includes("‚úÖ")) {
                winSound.loop = true;
                winSound.play();
            } else if (message.toLowerCase().includes("game over")) {
                loseSound.loop = true;
                loseSound.play();
            }

            document.querySelectorAll("form").forEach(form => {
                form.addEventListener("submit", function () {
                    const formType = form.querySelector('input[name="form_type"]');
                    if (formType) {
                        const value = formType.value;
                        if (value === "go_back" || value === "set_difficulty" || value === "start_guessing") {
                            winSound.pause();
                            winSound.currentTime = 0;
                            loseSound.pause();
                            loseSound.currentTime = 0;
                        }
                    }
                });
            });
        </script>
    {% endif %}
</body>
</html>